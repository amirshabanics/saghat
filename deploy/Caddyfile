# ── Development (HTTP only) ────────────────────────────────────────────────────
# Usage: set CADDY_HOST=:80 in environment, or use the prod block below

{$CADDY_HOST:localhost} {

    # Health check endpoint
    handle /_health {
        respond "OK" 200
    }

    # Django API — proxy to gunicorn
    handle /api/* {
        reverse_proxy web:8000
    }

    # Django admin
    handle /admin/* {
        reverse_proxy web:8000
    }

    # Django static files
    handle /static/* {
        root * /static_root
        file_server
    }

    # React SPA — serve built assets, fallback to index.html for client-side routing
    handle {
        root * /srv/frontend
        try_files {path} {path}/ /index.html
        file_server
    }

    # Logging
    log {
        output stdout
        format console
    }
}
